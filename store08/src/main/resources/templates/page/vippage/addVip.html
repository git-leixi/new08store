<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="../common/layui/css/layui.css">
    <script src="../common/layui/layui.js"></script>
</head>
<body>
<div>
    <form class="layui-form layui-from-pane"  style="margin-top:20px" method="post">
        <div class="layui-form-item">
            <label class="layui-form-label">会员姓名</label>
            <div class="layui-input-block">
                <input type="text" id="vName" style="width: 230px"  required  lay-verify="required" autocomplete="off" placeholder="请输入会员的姓名" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">手机号码</label>
            <div class="layui-input-block">
                <input type="text" id="vPhone"  style="width: 230px"  required  lay-verify="required" autocomplete="off" placeholder="请输入会员的手机号码" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">会员金额</label>
            <div class="layui-input-block">
                <input type="text" id="vAcount" style="width: 230px"  required  lay-verify="required" autocomplete="off" placeholder="请输入会员的金额" class="layui-input">
            </div>
        </div>
        <div class="layui-btn-group">
            <button type="button"   class="layui-btn layui-btn-primary layui-btn-sm" style="left: 80px">请选择充值金额</button>
            <button type="button" onclick="czje(500)" class="layui-btn layui-btn-primary layui-btn-sm">500</button>
            <button type="button" onclick="czje(800)" class="layui-btn layui-btn-primary layui-btn-sm">800</button>
            <button type="button" onclick="czje(1200)" class="layui-btn layui-btn-primary layui-btn-sm">1200</button>
            <button type="button" onclick="czje(2000)" class="layui-btn layui-btn-primary layui-btn-sm">2000</button>
            <button type="button" onclick="czje(3000)" class="layui-btn layui-btn-primary layui-btn-sm">3000</button>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">会员类型</label>
            <div class="layui-input-block" style="width: 250px">
                <input type="text" id="vGrade" readonly  style="width: 350px"  lay-verify="required" autocomplete="off" placeholder="会员等级" class="layui-input">
                <input type="hidden" id="vIdc"  class="layui-input">

                <!--   下拉框 等级查询
                <select id="vIdc"  lay-filter="aihao">
                    <option th:each="t:${typeFindall}"  readonly="readonly" th:value="${t.vIdc}" th:text="|${t.vGrade},  最低消费金额: ${t.vLimit}元|"></option>

                </select>-->
            </div>
        </div>

        <div class="layui-form-item" style="margin-top:40px">
            <div class="layui-input-block">
                <button class="layui-btn  layui-btn-submit " lay-submit="stffadd" lay-filter="demo1">立即提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                <button type="button" class="layui-btn layui-btn-primary" id="qx">取消</button>
            </div>
        </div>
    </form>
</div>
<script type="text/javascript">
    //  按钮值 绑定在 充值金额框
    function  czje(data1) {
        $("#vAcount").val(data1);
        $.ajax({
            url:"../vip/selVid",
            type:"post",
            async:false,
            data:{
                vAcount:data1,
            },
            dataType:"text",
            success:function(data){
               var ix =  data.indexOf(".");
               var vidc =  data.substring(0,ix);
                $("#vGrade").val(data);
                $("#vIdc").val(vidc);
            }
        });
    }


    layui.use(['form','layer'],function(){
        var form = layui.form;
        var layer = layui.layer;
        $ = layui.jquery;
        form.render();
        form.on('submit(demo1)',function(data){
            var vName = $("#vName").val();
            var vPhone = $("#vPhone").val();
            var vAcount = $("#vAcount").val();
            var vIdc = $("#vIdc").val();
            $.ajax({
                url:"../vip/addVip",
                type:"post",
                async:false,
                data:{
                    vName:vName,
                    vPhone:vPhone,
                    vIdc:vIdc,
                    vAcount:vAcount,
                },
                dataType:"json",
                success:function(data){
                    if(data>0){
                        window.parent.location.reload();
                        var index = parent.layer.getFrameIndex(window.name);
                        parent.layer.close(index);
                    }else{
                        alert("添加失败！");
                        var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
                        window.parent.location.reload();
                        window.parent.layer.close(index);
                    }
                }
            });

        });
        $("#qx").on("click",function(){
            var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
            parent.layer.close(index);
        })

        $("#vAcount").bind("change", function(){
            var va  = $("#vAcount").val();
            $.ajax({
                url:"../vip/selVid",
                type:"post",
                async:false,
                data:{
                    vAcount:va,
                },
                dataType:"text",
                success:function(data){
                    $("#vGrade").val(data);

                }
            });
        })

    });


</script>
</body>
</html>